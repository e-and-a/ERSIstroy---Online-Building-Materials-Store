generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Unit {
  piece
  bag
  sqm
  meter
  pack
  pallet
}

enum OrderStatus {
  NEW
  CHECKING
  WAITING_CUSTOMER
  CONFIRMED
  COMPLETED
  CANCELED
}

enum ContactMethod {
  call
  whatsapp
  telegram
  email
}

enum OrderType {
  order
  calculation_request
}

model Category {
  id        String     @id @default(cuid())
  name      String
  slug      String     @unique
  parentId  String?
  parent    Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children  Category[] @relation("CategoryHierarchy")
  products  Product[]
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model Product {
  id          String    @id @default(cuid())
  name        String
  slug        String    @unique
  description String?
  categoryId  String
  category    Category  @relation(fields: [categoryId], references: [id])
  images      ProductImage[]
  price       Decimal   @db.Decimal(12, 2)
  unit        Unit
  weight      Decimal?  @db.Decimal(10, 2)
  volume      Decimal?  @db.Decimal(10, 2)
  isAvailable Boolean   @default(true)
  isOnDemand  Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  items       OrderItem[]
}

model ProductImage {
  id        String  @id @default(cuid())
  productId String
  url       String
  product   Product @relation(fields: [productId], references: [id])
}

model Order {
  id               String        @id @default(cuid())
  createdAt        DateTime      @default(now())
  status           OrderStatus   @default(NEW)
  customerName     String
  phone            String
  email            String
  city             String
  contactMethod    ContactMethod
  comment          String?
  type             OrderType     @default(order)
  totalPriceClient Decimal?      @db.Decimal(12, 2)
  managerNotes     String?
  items            OrderItem[]
  updatedAt        DateTime      @updatedAt
}

model OrderItem {
  id             String   @id @default(cuid())
  orderId        String
  productId      String?
  productName    String
  quantity       Int
  priceAtMoment  Decimal  @db.Decimal(12, 2)
  unit           Unit
  order          Order    @relation(fields: [orderId], references: [id])
  product        Product? @relation(fields: [productId], references: [id])
  createdAt      DateTime @default(now())
}

